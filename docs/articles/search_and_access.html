<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search and Access Data • EDIutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Search and Access Data">
<meta property="og:description" content="EDIutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EDIutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/search_and_access.html">Search and Access Data</a>
    </li>
    <li>
      <a href="../articles/evaluate_and_upload.html">Evaluate and Upload Data</a>
    </li>
    <li>
      <a href="../articles/retrieve_downloads.html">Retrieve Download Metrics</a>
    </li>
    <li>
      <a href="../articles/retrieve_citations.html">Retrieve Citation Metrics</a>
    </li>
    <li>
      <a href="../articles/tests_requiring_authentication.html">Tests Requiring Authentication</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EDIorg/EDIutils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="search_and_access_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Search and Access Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EDIorg/EDIutils/blob/master/vignettes/search_and_access.Rmd"><code>vignettes/search_and_access.Rmd</code></a></small>
      <div class="hidden name"><code>search_and_access.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EDIorg/EDIutils">EDIutils</a></span><span class="op">)</span></code></pre></div>
<div id="search" class="section level2">
<h2 class="hasAnchor">
<a href="#search" class="anchor"></a>Search</h2>
<p>The repository search service is a standard deployment of Apache Solr and indexes select metadata fields of data packages. Some of the possible motivations for using the search API include:</p>
<ul>
<li><p>Building a custom search interface that offers some feature not found in the EDI data portal (e.g. build a query interface where the search results are always restricted to a particular research project).</p></li>
<li><p>Building a local data catalog. In this case we are constructing the query in our program and displaying a table of matching documents for our local site including things like title, authors, keywords, and perhaps the abstract.</p></li>
<li><p>Mining data where EML metadata is the data to be mined, processed, or analyzed in some way.</p></li>
<li><p>Increased efficiency in that using the search API is often faster than relying on the data portal where the results are displayed in HTML and paged 10 documents at a time.</p></li>
</ul>
<p>For a list of searchable fields see <code><a href="../reference/search_data_packages.html">search_data_packages()</a></code>. For more on constructing Solr queries see the <a href="https://cwiki.apache.org/confluence/display/solr/">Apache Solr Wiki</a>. For a browser based search experience use the <a href="https://portal.edirepository.org/nis/advancedSearch.jsp">EDI data portal</a>.</p>
<p>Results can be filtered to include only fields of interest.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Match all documents with keywords "disturbance" and return only their IDs</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">'q=keyword:disturbance&amp;fl=id'</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="12845" start="0" rows="10"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;id&gt;knb-lter-luq.197&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;id&gt;knb-lter-and.3982&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;id&gt;knb-lter-luq.169&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;id&gt;knb-lter-and.3983&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10435&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [6] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10436&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [7] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10450&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [8] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10451&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [9] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10452&lt;/id&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [10] &lt;document&gt;\n  &lt;id&gt;knb-lter-arc.10453&lt;/id&gt;\n&lt;/document&gt;</span></code></pre></div>
<p>When constructing a query note that the 15403 data packages of the <a href="https://lternet.edu/the-ecotrends-project/">ecotrends</a> project and 10492 data packages of the <a href="https://lternet.edu/lter-remote-sensing-and-geographic-information-system-data/">LTER Landsat</a> project, can be excluded from the returned results by including <code>&amp;fq=-scope:(ecotrends+lter-landsat)</code> in the query string.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Match all documents with keywords "disturbance", excluding ecotrends and </span>
<span class="co"># lter-landsat scopes from the returned results</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'q=keyword:disturbance&amp;fl=packageid&amp;fq=-scope:(ecotrends+lter-landsat)'</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="12841" start="0" rows="10"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-luq.197.62&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-and.3982.7&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-luq.169.65&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-and.3983.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10435.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [6] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10436.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [7] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10450.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [8] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10451.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [9] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10452.4&lt;/packageid&gt;\n&lt;/document&gt;</span>
<span class="co">#&gt;   [10] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-arc.10453.4&lt;/packageid&gt;\n&lt;/document&gt;</span></code></pre></div>
<p>Use wild cards operators to match anything and control the number of returned results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Match anything, display all fields, limit to only one document</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">'q=*&amp;fl=*&amp;rows=1'</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="44907" start="0" rows="1"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;abstract&gt;The EcoTrends project was established in ...</span></code></pre></div>
<p>Use scope, keyword, and author fields to get all data packages belonging to a research site, organization, or author.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find all FCE LTER data packages, displaying the package id, title, and DOI</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'q=scope:knb-lter-fce&amp;fl=packageid,title,doi&amp;rows=100'</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="183" start="0" rows="100"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1076.4&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1077.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1078.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1081.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1085.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [6] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1087.4&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [7] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1088.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [8] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1089.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [9] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1090.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt;   [10] &lt;document&gt;\n  &lt;packageid&gt;knb-lter-fce.1091.3&lt;/packageid&gt;\n  &lt;title&gt; ...</span>
<span class="co">#&gt; ...</span>

<span class="co"># Non-LTER projects publish under the "edi" scope and group data packages by a </span>
<span class="co"># unique keyword. Find all data packages belonging to the Interagency </span>
<span class="co"># Ecological Program</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'q=scope:edi+AND+keyword:"Interagency+Ecological+Program"&amp;fl=*'</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="22" start="0" rows="10"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;abstract&gt;The U.S. Fish and Wildlife Service (USFWS) ...</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;abstract&gt;The Suisun Marsh Salinity Control Gates ...</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;abstract&gt;Natural history museum specimen are ...</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;abstract&gt;Dissolved oxygen levels in the Stockton Deep ...</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;abstract&gt;Projected temperature increases due to global ...</span>
<span class="co">#&gt;   [6] &lt;document&gt;\n  &lt;abstract&gt;The Interagency Ecological Program San ...</span>
<span class="co">#&gt;   [7] &lt;document&gt;\n  &lt;abstract&gt;The Interagency Ecological Program San ...</span>
<span class="co">#&gt;   [8] &lt;document&gt;\n  &lt;abstract&gt;The Fish Restoration Program Monitoring Team ...</span>
<span class="co">#&gt;   [9] &lt;document&gt;\n  &lt;abstract&gt;The Interagency Ecological Program San ...</span>
<span class="co">#&gt;   [10] &lt;document&gt;\n  &lt;abstract&gt;The upper San Francisco Estuary is an inland ...</span>

<span class="co"># Query on author</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'q=author:duane+costa&amp;fq=author:costa&amp;fl=id,title,author,score'</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="5" start="0" rows="10"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;id&gt;knb-lter-vcr.147&lt;/id&gt;\n  &lt;title&gt;Keywords and Terms ...</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;id&gt;knb-lter-nwk.4&lt;/id&gt;\n  &lt;title&gt;EML congruence checker ...</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;id&gt;knb-lter-nwk.3&lt;/id&gt;\n  &lt;title&gt;Congruence checks for ...</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;id&gt;edi.638&lt;/id&gt;\n  &lt;title&gt;Stream temperatures in the ...</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;id&gt;knb-lter-hfr.104&lt;/id&gt;\n  &lt;title&gt;Adult Population ...</span></code></pre></div>
<p>Queries can be complex.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Query on subject "Primary Production" OR subject "plant". Note that 'subject'</span>
<span class="co"># is an aggregation of several other fields containing searchable text: </span>
<span class="co"># 'author', 'organization', 'title', 'keyword', and 'abstract' fields rolled</span>
<span class="co"># together into a single searchable field.</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'q=subject:("Primary+Production")+OR+subject:plant&amp;fq='</span>,
                <span class="st">'-scope:ecotrends&amp;fq=-scope:lter-landsat*&amp;fl=id,packageid,'</span>,
                <span class="st">'title,author,organization,pubdate,coordinates'</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_data_packages.html">search_data_packages</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;resultset numFound="2679" start="0" rows="10"&gt;</span>
<span class="co">#&gt;   [1] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.298&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [2] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.206&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [3] &lt;document&gt;\n  &lt;id&gt;knb-lter-ntl.72&lt;/id&gt;\n  &lt;packageid&gt;knb-lter-n ...</span>
<span class="co">#&gt;   [4] &lt;document&gt;\n  &lt;id&gt;knb-lter-kbs.19&lt;/id&gt;\n  &lt;packageid&gt;knb-lter-k ...</span>
<span class="co">#&gt;   [5] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.186&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [6] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.205&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [7] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.182&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [8] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.290&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [9] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.289&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span>
<span class="co">#&gt;   [10] &lt;document&gt;\n  &lt;id&gt;knb-lter-sev.155&lt;/id&gt;\n  &lt;packageid&gt;knb-lter- ...</span></code></pre></div>
<p>An alternative method for searching and retrieving metadata is the “list and read” method. It involves listing data package identifiers of interest, then read the corresponding metadata of those data packages one at a time, parsing and extracting whatever metadata from them that you’re interested in searching or doing additional processing on. Although this sounds like more work than using the search API, and in fact it generally is, there are some use cases where this might be the preferred approach. For example this list and read method allows access to previous versions of a data package, whereas the search API only provides access to the most recent version, and this method provides access to all EML content, not just indexed fields.</p>
</div>
<div id="access" class="section level2">
<h2 class="hasAnchor">
<a href="#access" class="anchor"></a>Access</h2>
<p>The EDI data repository provides open access to archived data as packages. Packages can be downloaded in .zip format or their individual data entities downloaded as raw bytes and files. Entities with a common format can be parsed simply by most readers while more complex formats need metadata to help with parsing.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A data package</span>
<span class="va">packageId</span> <span class="op">&lt;-</span> <span class="st">"edi.1047.1"</span></code></pre></div>
<p>Downloading a data package archive (.zip) requires a data package ID.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Request a zip archive</span>
<span class="va">transaction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_data_package_archive.html">create_data_package_archive</a></span><span class="op">(</span><span class="va">packageId</span><span class="op">)</span>
<span class="va">transaction</span>
<span class="co">#&gt; [1] "archive_edi.1047.1_14896683904724129"</span>

<span class="co"># Check status of the request (no response indicates success)</span>
<span class="fu"><a href="../reference/read_data_package_error.html">read_data_package_error</a></span><span class="op">(</span><span class="va">transaction</span><span class="op">)</span>

<span class="co"># Download to path</span>
<span class="fu"><a href="../reference/read_data_package_archive.html">read_data_package_archive</a></span><span class="op">(</span><span class="va">packageId</span>, <span class="va">transaction</span>, path <span class="op">=</span> <span class="st">"./data"</span><span class="op">)</span>
<span class="co">#&gt; |=============================================================| 100%</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="st">"./data"</span><span class="op">)</span>
<span class="co">#&gt; [1] ""edi.1047.1.zip"</span></code></pre></div>
<p>Downloading an individual data entity requires the entity ID.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># List data entities of the data package</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data_entity_names.html">read_data_entity_names</a></span><span class="op">(</span><span class="va">packageId</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt;                           entityId                entityName</span>
<span class="co">#&gt; 1 3abac5f99ecc1585879178a355176f6d        Environmentals.csv</span>
<span class="co">#&gt; 2 f6bfa89b48ced8292840e53567cbf0c8               ByCatch.csv</span>
<span class="co">#&gt; 3 c75642ddccb4301327b4b1a86bdee906               Chinook.csv</span>
<span class="co">#&gt; 4 2c9ee86cc3f3ffc729c5f18bfe0a2a1d             Steelhead.csv</span>
<span class="co">#&gt; 5 785690848dd20f4910637250cdc96819 TrapEfficiencyRelease.csv</span>
<span class="co">#&gt; 6 58b9000439a5671ea7fe13212e889ba5 TrapEfficiencySummary.csv</span>
<span class="co">#&gt; 7 86e61c1a501b7dcf0040d10e009bfd87        TrapOperations.csv</span>

<span class="co"># Download Steelhead.csv in raw bytes. Use the entityName and entityID as keys.</span>
<span class="va">entityName</span> <span class="op">&lt;-</span> <span class="st">"Steelhead.csv"</span>
<span class="va">entityId</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">entityId</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">entityName</span> <span class="op">==</span> <span class="va">entityName</span><span class="op">]</span>
<span class="va">raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data_entity.html">read_data_entity</a></span><span class="op">(</span><span class="va">packageId</span>, <span class="va">entityId</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span>
<span class="co">#&gt; [1] ef bb bf 44 61 74</span></code></pre></div>
<p>Common formats are easily parsed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># These data have a common format are simply parsed</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">raw</span><span class="op">)</span>
<span class="va">data</span>
<span class="co">#&gt; # A tibble: 2,926 x 14</span>
<span class="co">#&gt;    Date   trapVisitID subSiteName catchRawID releaseID commonName </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      </span>
<span class="co">#&gt;  1 1/12/~         326 North Chan~      32123         0 Steelhead ~</span>
<span class="co">#&gt;  2 1/14/~         336 North Chan~      33980         0 Steelhead ~</span>
<span class="co">#&gt;  3 1/15/~         337 North Chan~      32683         0 Steelhead ~</span>
<span class="co">#&gt;  4 1/16/~         339 North Chan~      32971         0 Steelhead ~</span>
<span class="co">#&gt;  5 1/17/~         341 North Chan~      33104         0 Steelhead ~</span>
<span class="co">#&gt;  6 1/18/~         342 North Chan~      33304         0 Steelhead ~</span>
<span class="co">#&gt;  7 1/19/~         343 North Chan~      33432         0 Steelhead ~</span>
<span class="co">#&gt;  8 1/21/~         349 North Chan~      34083         0 Steelhead ~</span>
<span class="co">#&gt;  9 1/21/~         349 North Chan~      34084         0 Steelhead ~</span>
<span class="co">#&gt; 10 1/23/~         351 North Chan~      34384         0 Steelhead ~</span>
<span class="co">#&gt; # ... with 2,916 more rows, and 8 more variables:</span>
<span class="co">#&gt; #   lifeStage &lt;chr&gt;, forkLength &lt;dbl&gt;, weight &lt;dbl&gt;, n &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mort &lt;chr&gt;, fishOrigin &lt;chr&gt;, markType &lt;chr&gt;,</span>
<span class="co">#&gt; #   CatchRaw.comments &lt;chr&gt;</span></code></pre></div>
<p>Less common formats require metadata for parsing. This metadata is listed under the “physical” node of a data entities EML.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read the same data entity but using the physical metadata</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span>
<span class="va">eml</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_metadata.html">read_metadata</a></span><span class="op">(</span><span class="va">packageId</span><span class="op">)</span>
<span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_metadata_entity.html">read_metadata_entity</a></span><span class="op">(</span><span class="va">packageId</span>, <span class="va">entityId</span><span class="op">)</span>
<span class="va">fieldDelimiter</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_first</a></span><span class="op">(</span><span class="va">meta</span>, <span class="st">".//physical//fieldDelimiter"</span><span class="op">)</span><span class="op">)</span>
<span class="va">numHeaderLines</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_double</a></span><span class="op">(</span><span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_first</a></span><span class="op">(</span><span class="va">meta</span>, <span class="st">".//physical//numHeaderLines"</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span>
  file <span class="op">=</span> <span class="va">raw</span>, 
  delim <span class="op">=</span> <span class="va">fieldDelimiter</span>, 
  skip <span class="op">=</span> <span class="va">numHeaderLines</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="va">data</span>
<span class="co">#&gt; # A tibble: 2,926 x 14</span>
<span class="co">#&gt;    Date   trapVisitID subSiteName catchRawID releaseID commonName </span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      </span>
<span class="co">#&gt;  1 1/12/~         326 North Chan~      32123         0 Steelhead ~</span>
<span class="co">#&gt;  2 1/14/~         336 North Chan~      33980         0 Steelhead ~</span>
<span class="co">#&gt;  3 1/15/~         337 North Chan~      32683         0 Steelhead ~</span>
<span class="co">#&gt;  4 1/16/~         339 North Chan~      32971         0 Steelhead ~</span>
<span class="co">#&gt;  5 1/17/~         341 North Chan~      33104         0 Steelhead ~</span>
<span class="co">#&gt;  6 1/18/~         342 North Chan~      33304         0 Steelhead ~</span>
<span class="co">#&gt;  7 1/19/~         343 North Chan~      33432         0 Steelhead ~</span>
<span class="co">#&gt;  8 1/21/~         349 North Chan~      34083         0 Steelhead ~</span>
<span class="co">#&gt;  9 1/21/~         349 North Chan~      34084         0 Steelhead ~</span>
<span class="co">#&gt; 10 1/23/~         351 North Chan~      34384         0 Steelhead ~</span>
<span class="co">#&gt; # ... with 2,916 more rows, and 8 more variables:</span>
<span class="co">#&gt; #   lifeStage &lt;chr&gt;, forkLength &lt;dbl&gt;, weight &lt;dbl&gt;, n &lt;dbl&gt;,</span>
<span class="co">#&gt; #   mort &lt;chr&gt;, fishOrigin &lt;chr&gt;, markType &lt;chr&gt;,</span>
<span class="co">#&gt; #   CatchRaw.comments &lt;chr&gt;</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Colin Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
